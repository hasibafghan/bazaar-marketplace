{% extends 'include/base.html' %}
{% load static %}

{% block content %}
  <!-- ========================= SECTION PAGETOP ========================= -->
  <section class="section-pagetop bg">
    <div class="container">
      <h2 class="title-page">Our Store</h2>
    </div> <!-- container // -->
  </section>
  <!-- ========================= SECTION INTRO END// ========================= -->

  <!-- ========================= SECTION CONTENT ========================= -->
  <section class="section-content padding-y">
    <div class="container">
      <div class="row">
        <aside class="col-md-3">
          <div class="card">
            <article class="filter-group">
              <header class="card-header">
                <a href="#" data-toggle="collapse" data-target="#collapse_1" aria-expanded="true" class="">
                  <i class="icon-control fa fa-chevron-down"></i>
                  <h6 class="title">Categories</h6>
                </a>
              </header>
              <div class="filter-content collapse show" id="collapse_1" style="">
                <div class="card-body">
                  <ul class="list-menu">
                    <li>
                      <a class="dropdown-item text-dark" href="{% url 'product_list' %}">All Products</a>
                    </li>
                    {% for cat in categories %}
                      <li>
                        <a class="dropdown-item text-dark" href="{% url 'products_by_category' cat.slug %}">{{ cat.category_name }}</a>
                      </li>
                    {% endfor %}
                  </ul>
                </div> <!-- card-body.// -->
              </div>
            </article> <!-- filter-group .// -->
            {% comment %} <article class="filter-group">
              <header class="card-header">
                <a href="#" data-toggle="collapse" data-target="#collapse_4" aria-expanded="true" class="">
                  <i class="icon-control fa fa-chevron-down"></i>
                  <h6 class="title">Sizes</h6>
                </a>
              </header>
              <div class="filter-content collapse show" id="collapse_4" style="">
                <div class="card-body">
                  <label class="checkbox-btn">
                    <input type="checkbox" />
                    <span class="btn btn-light">XS</span>
                  </label>

                  <label class="checkbox-btn">
                    <input type="checkbox" />
                    <span class="btn btn-light">SM</span>
                  </label>

                  <label class="checkbox-btn">
                    <input type="checkbox" />
                    <span class="btn btn-light">LG</span>
                  </label>

                  <label class="checkbox-btn">
                    <input type="checkbox" />
                    <span class="btn btn-light">XXL</span>
                  </label>
                </div>
                <!-- card-body.// -->
              </div>
            </article> <!-- filter-group .// --> {% endcomment %}

<article class="filter-group">
    <header class="card-header">
        <a href="#" data-toggle="collapse" data-target="#collapse_3" aria-expanded="true" class="">
            <i class="icon-control fa fa-chevron-down"></i>
            <h6 class="title">Price range</h6>
        </a>
    </header>
    <div class="filter-content collapse show" id="collapse_3" style="">
        <div class="card-body">
            <form method="GET" action="">
                <!-- Preserve page and search parameters -->
                {% if request.GET.page %}
                    <input type="hidden" name="page" value="{{ request.GET.page }}">
                {% endif %}
                {% if request.GET.search %}
                    <input type="hidden" name="search" value="{{ request.GET.search }}">
                {% endif %}
                
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label>Min</label>
                        <select name="min_price" class="form-control" onchange="this.form.submit()">
                            <option value="">Any Min</option>
                            <option value="0" {% if selected_min == '0' or not selected_min %}selected{% endif %}>$0</option>
                            {% for price in price_options %}
                                {% if price > 0 %}
                                    <option value="{{ price }}" {% if selected_min == price|stringformat:"i" %}selected{% endif %}>
                                        ${{ price }}
                                    </option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label>Max</label>
                        <select name="max_price" class="form-control" onchange="this.form.submit()">
                            <option value="">Any Max</option>
                            {% for price in price_options %}
                                <option value="{{ price }}" {% if selected_max == price|stringformat:"i" %}selected{% endif %}>
                                    ${{ price }}
                                </option>
                            {% endfor %}
                            <option value="{{ max_price|add:100 }}" {% if selected_max == max_price|add:100|stringformat:"i" %}selected{% endif %}>
                                ${{ max_price|add:100 }}+
                            </option>
                        </select>
                    </div>
                </div> <!-- form-row.// -->
                
                <!-- Quick Price Buttons -->
                <div class="mt-2">
                    <small class="text-muted">Quick select:</small>
                    <div class="btn-group btn-group-sm w-100 mt-1">
                        <a href="?{% if request.GET.page %}page={{ request.GET.page }}&{% endif %}{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}min_price=0&max_price=50" 
                           class="btn btn-outline-secondary {% if selected_min == '0' and selected_max == '50' %}active{% endif %}">
                            Under $50
                        </a>
                        <a href="?{% if request.GET.page %}page={{ request.GET.page }}&{% endif %}{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}min_price=50&max_price=100" 
                           class="btn btn-outline-secondary {% if selected_min == '50' and selected_max == '100' %}active{% endif %}">
                            $50-100
                        </a>
                        <a href="?{% if request.GET.page %}page={{ request.GET.page }}&{% endif %}{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}min_price=100&max_price=200" 
                           class="btn btn-outline-secondary {% if selected_min == '100' and selected_max == '200' %}active{% endif %}">
                            $100-200
                        </a>
                    </div>
                </div>
                
                <!-- Clear Filter Button -->
                {% if selected_min or selected_max %}
                <div class="mt-2">
                    <a href="?{% if request.GET.page %}page={{ request.GET.page }}&{% endif %}{% if request.GET.search %}search={{ request.GET.search }}{% endif %}" 
                       class="btn btn-sm btn-outline-danger w-100">
                        Clear Price Filter
                    </a>
                </div>
                {% endif %}
            </form>
        </div> <!-- card-body.// -->
    </div>
</article> <!-- filter-group .// -->
          </div> <!-- card.// -->
        </aside> <!-- col.// -->
        <main class="col-md-9">
          <header class="border-bottom mb-4 pb-3">
            <div class="form-inline">
              <span class="mr-md-auto">{{ products_counter }} Items found</span>
            </div>
          </header>
          <!-- sect-heading -->

          <div class="row">
            {% if products %}
              {% for product in products %}
                <div class="col-md-4">
                  <figure class="card card-product-grid">
                    <div class="img-wrap">
                      <a href="{% url 'product_detail' product.category.slug product.slug %}"><img src="{{ product.images.url }}" /></a>
                    </div> <!-- img-wrap.// -->
                    <figcaption class="info-wrap">
                      <div class="fix-height">
                        <a href="{{ product.get_url }}" class="title">{{ product.product_name }}</a>
                        <div class="price-wrap mt-2">
                          <span class="price">${{ product.price }}</span>
                          <del class="price-old">${{ product.old_price }}</del>
                        </div> <!-- price-wrap.// -->
                      </div>
                      <a href="{{ product.get_url }}" class="btn btn-block btn-primary">View Details</a>
                    </figcaption>
                  </figure>
                </div> <!-- col.// -->
              {% endfor %}
            {% else %}
              <h3>No Product Found!</h3>
            {% endif %}
          </div> <!-- row end.// -->

          <!-- pagination -->
          <nav class="mt-4" aria-label="Page navigation sample">
            <nav class="mt-4" aria-label="Page navigation">
              {% if products.has_other_pages %}
                <ul class="pagination">
                  {# Previous Button #}
                  {% if products.has_previous %}
                    <li class="page-item">
                      <a class="page-link"
                        href="?{% if request.GET.search %}
                          
                          search={{ request.GET.search }}&

                        {% endif %}page={{ products.previous_page_number }}">
                        Previous
                      </a>
                    </li>
                  {% else %}
                    <li class="page-item disabled">
                      <a class="page-link" href="#">Previous</a>
                    </li>
                  {% endif %}

                  {# Only show 3 pages around current #}
                  {% for i in products.paginator.page_range %}
                    {% if i >= products.number|add:'-1' and i <= products.number|add:'1' %}
                      {% if products.number == i %}
                        <li class="page-item active">
                          <a class="page-link" href="#">{{ i }}</a>
                        </li>
                      {% else %}
                        <li class="page-item">
                          <a class="page-link"
                            href="?{% if request.GET.search %}
                              
                              search={{ request.GET.search }}&

                            {% endif %}page={{ i }}">
                            {{ i }}
                          </a>
                        </li>
                      {% endif %}
                    {% endif %}
                  {% endfor %}

                  {# Next Button #}
                  {% if products.has_next %}
                    <li class="page-item">
                      <a class="page-link"
                        href="?{% if request.GET.search %}
                          
                          search={{ request.GET.search }}&

                        {% endif %}page={{ products.next_page_number }}">
                        Next
                      </a>
                    </li>
                  {% else %}
                    <li class="page-item disabled">
                      <a class="page-link" href="#">Next</a>
                    </li>
                  {% endif %}
                </ul>
              {% endif %}
            </nav>
          </nav>
        </main> <!-- col.// -->
      </div>
    </div> <!-- container .// -->
  </section>
  <!-- ========================= SECTION CONTENT END// ========================= -->
{% endblock %}

<!-- THIS IS A FEATURE THAT WHEN THE ITEMS THAT YOR SEARCH END IT SHOW ANOTHER PRODUCTS! -->
{% comment %} <nav class="mt-4" aria-label="Page navigation sample">
  <nav class="mt-4" aria-label="Page navigation">
    {% if products.has_other_pages %}
      <ul class="pagination">
        {# Previous Button #}
        {% if products.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ products.previous_page_number }}">Previous</a>
          </li>
        {% else %}
          <li class="page-item disabled">
            <a class="page-link" href="#">Previous</a>
          </li>
        {% endif %}

        {# Only show 3 pages around current #}
        {% for i in products.paginator.page_range %}
          {% if i >= products.number|add:'-1' and i <= products.number|add:'1' %}
            {% if products.number == i %}
              <li class="page-item active">
                <a class="page-link" href="#">{{ i }}</a>
              </li>
            {% else %}
              <li class="page-item">
                <a class="page-link" href="?page={{ i }}">{{ i }}</a>
              </li>
            {% endif %}
          {% endif %}
        {% endfor %}

        {# Next Button #}
        {% if products.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ products.next_page_number }}">Next</a>
          </li>
        {% else %}
          <li class="page-item disabled">
            <a class="page-link" href="#">Next</a>
          </li>
        {% endif %}
      </ul>
    {% endif %}
  </nav>
</nav> {% endcomment %}
