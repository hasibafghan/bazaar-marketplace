{% extends 'include/base.html' %}
{% load static %}

{% block title %}Payment Successful{% endblock %}

{% block content %}
<section class="section-content padding-y bg-light">
  <div class="container">


    <!-- Order Summary -->
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="card shadow-sm border-0">
          <div class="card-body p-4">
            <div class="row">
              <div class="col-md-6 mb-3 mb-md-0">
                <div class="text-center text-md-start">
                  <img src="{% static 'images/logo.png' %}" alt="Company Logo" class="img-fluid mb-3" style="max-height: 50px;">
                  <h5 class="text-muted">Thank you for your order</h5>
                </div>
              </div>
              <div class="col-md-6">
                <div class="text-center text-md-end">
                  <h5 class="text-muted">Order Details</h5>
                  <ul class="list-unstyled">
                    {% if order %}
                    <li><strong>Order #:</strong> {{ order.order_number }}</li>
                    {% endif %}
                    <li><strong>Transaction #:</strong>
                      {% if payment %}
                        {{ payment.payment_id }}
                      {% elif order and order.payment %}
                        {{ order.payment.payment_id }}
                      {% else %}
                        N/A
                      {% endif %}
                    </li>
                    <li><strong>Date:</strong> {% now "F j, Y" %}</li>
                    <li><strong>Status:</strong> <span class="badge bg-success">PAID</span></li>
                  </ul>
                </div>
              </div>
            </div>

            <hr class="my-4">

            <!-- Order Items -->
            <div class="table-responsive">
              <table class="table table-bordered">
                <thead class="table-light">
                  <tr>
                    <th class="text-center">Product</th>
                    <th class="text-center">Quantity</th>
                    <th class="text-center">Price</th>
                    <th class="text-center">Total</th>
                  </tr>
                </thead>
                <tbody>
                  {# Prefer order_products from the view; fallback to order.orderproduct_set.all #}
                  {% if order_products %}
                    {% for order_product in order_products %}
                      <tr>
                        <td>
                          <div class="d-flex align-items-center">
                            {% if order_product.product.images %}
                              <img src="{{ order_product.product.images.url }}" alt="{{ order_product.product.product_name }}" class="img-fluid rounded me-3" width="60">
                            {% else %}
                              <img src="{% static 'images/placeholder.png' %}" alt="{{ order_product.product.product_name }}" class="img-fluid rounded me-3" width="60">
                            {% endif %}
                            <div>
                              <h6 class="mb-0">{{ order_product.product.product_name }}</h6>
                              {% if order_product.variations.all %}
                                <small class="text-muted">
                                  {% for var in order_product.variations.all %}
                                    {{ var.variation_value }}{% if not forloop.last %}, {% endif %}
                                  {% endfor %}
                                </small>
                              {% endif %}
                            </div>
                          </div>
                        </td>
                        <td class="text-center align-middle">{{ order_product.quantity }}</td>
                        <td class="text-center align-middle">${{ order_product.product_price|floatformat:2 }}</td>
                        <td class="text-center align-middle">
                          {% comment %}Line total not computed in template; show product_price × qty visually{% endcomment %}
                          ${{ order_product.product_price|floatformat:2 }} × {{ order_product.quantity }}
                        </td>
                      </tr>
                    {% endfor %}
                  {% elif order %}
                    {% for order_product in order.orderproduct_set.all %}
                      <tr>
                        <td>
                          <div class="d-flex align-items-center">
                            {% if order_product.product.images %}
                              <img src="{{ order_product.product.images.url }}" alt="{{ order_product.product.product_name }}" class="img-fluid rounded me-3" width="60">
                            {% else %}
                              <img src="{% static 'images/placeholder.png' %}" alt="{{ order_product.product.product_name }}" class="img-fluid rounded me-3" width="60">
                            {% endif %}
                            <div>
                              <h6 class="mb-0">{{ order_product.product.product_name }}</h6>
                              {% if order_product.variations.all %}
                                <small class="text-muted">
                                  {% for var in order_product.variations.all %}
                                    {{ var.variation_value }}{% if not forloop.last %}, {% endif %}
                                  {% endfor %}
                                </small>
                              {% endif %}
                            </div>
                          </div>
                        </td>
                        <td class="text-center align-middle">{{ order_product.quantity }}</td>
                        <td class="text-center align-middle">${{ order_product.product_price|floatformat:2 }}</td>
                        <td class="text-center align-middle">
                          ${{ order_product.product_price|floatformat:2 }} × {{ order_product.quantity }}
                        </td>
                      </tr>
                    {% endfor %}
                  {% else %}
                    <tr>
                      <td>Product Name</td>
                      <td class="text-center">1</td>
                      <td class="text-center">${{ order.order_total|default:"0.00" }}</td>
                      <td class="text-center">${{ order.order_total|default:"0.00" }}</td>
                    </tr>
                  {% endif %}
                </tbody>
                <tfoot class="table-light">
                  <tr>
                    <th colspan="3" class="text-end">Subtotal:</th>
                    <th class="text-center">${{ subtotal|default:order.order_total|floatformat:2 }}</th>
                  </tr>
                  <tr>
                    <th colspan="3" class="text-end">Tax:</th>
                    <th class="text-center">${{ order.tax|default:"0.00"|floatformat:2 }}</th>
                  </tr>
                  <tr>
                    <th colspan="3" class="text-end">Shipping:</th>
                    <th class="text-center text-success">FREE</th>
                  </tr>
                  <tr>
                    <th colspan="3" class="text-end">Grand Total:</th>
                    <th class="text-center">${{ grand_total|default:order.order_total|floatformat:2 }}</th>
                  </tr>
                </tfoot>
              </table>
            </div>

            <!-- Customer Information -->
            {% if order %}
            <div class="row mt-4">
              <div class="col-md-6">
                <h6 class="text-muted">Billing Information</h6>
                <address class="mb-0">
                  <strong>{{ order.first_name }} {{ order.last_name }}</strong><br>
                  {{ order.address_line_1 }}<br>
                  {% if order.address_line_2 %}{{ order.address_line_2 }}<br>{% endif %}
                  {{ order.city }}, {{ order.state }} {{ order.country }}<br>
                  <i class="fas fa-phone"></i> {{ order.phone }}<br>
                  <i class="fas fa-envelope"></i> {{ order.email }}
                </address>
              </div>
              <div class="col-md-6">
                <h6 class="text-muted">Shipping Information</h6>
                <address class="mb-0">
                  <strong>{{ order.first_name }} {{ order.last_name }}</strong><br>
                  {{ order.address_line_1 }}<br>
                  {% if order.address_line_2 %}{{ order.address_line_2 }}<br>{% endif %}
                  {{ order.city }}, {{ order.state }} {{ order.country }}<br>
                  <i class="fas fa-phone"></i> {{ order.phone }}
                </address>
              </div>
            </div>
            {% endif %}

            <!-- Order Note -->
            {% if order.order_note %}
            <div class="row mt-4">
              <div class="col-12">
                <h6 class="text-muted">Order Note</h6>
                <p class="mb-0 p-3 bg-light rounded">{{ order.order_note }}</p>
              </div>
            </div>
            {% endif %}

            <!-- Thank You Message -->
            <div class="text-center mt-4 pt-3  border-top">
              <p class="text-muted mb-3">Thank you for shopping with us! We'll send you a confirmation email shortly.</p>
              
              <!-- Action Buttons -->
              <div class="d-flex justify-content-center gap-3 flex-wrap">
                <a href="{% url 'product_list' %}" class="btn btn-primary mx-1 my-1">
                  <i class="fas fa-shopping-bag mx-2"></i>Continue Shopping
                </a>
                <a href="{% url 'home' %}" class="btn btn-outline-secondary mx-1 my-1">
                  <i class="fas fa-home mx-2"></i>Back to Home
                </a>
               
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


  </div>
</section>

<style>
.stepper-wrapper {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 0 auto;
  max-width: 800px;
}

.stepper-item {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
}

.stepper-item::before {
  position: absolute;
  content: '';
  border-bottom: 3px solid #dee2e6;
  width: 100%;
  top: 25px;
  left: -50%;
  z-index: 1;
}

.stepper-item::after {
  position: absolute;
  content: '';
  border-bottom: 3px solid #dee2e6;
  width: 100%;
  top: 25px;
  left: 50%;
  z-index: 1;
}

.stepper-item:first-child::before {
  content: none;
}

.stepper-item:last-child::after {
  content: none;
}

.step-counter {
  position: relative;
  z-index: 5;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: white;
  border: 3px solid #dee2e6;
  color: #6c757d;
  font-size: 1.2rem;
  margin-bottom: 12px;
  transition: all 0.3s ease;
}

.stepper-item.completed .step-counter {
  background-color: #4e73df;
  border-color: #4e73df;
  color: white;
}

.stepper-item.active .step-counter {
  background-color: white;
  border-color: #4e73df;
  color: #4e73df;
  transform: scale(1.1);
  box-shadow: 0 0 0 5px rgba(78, 115, 223, 0.2);
}

.stepper-item.completed::after,
.stepper-item.completed::before,
.stepper-item.active::before {
  border-color: #4e73df;
}

.step-name {
  font-weight: 600;
  color: #6c757d;
  font-size: 0.9rem;
  text-align: center;
}

.stepper-item.completed .step-name,
.stepper-item.active .step-name {
  color: #4e73df;
  font-weight: 700;
}

@media (max-width: 768px) {
  .stepper-wrapper {
    padding: 0 15px;
  }
  .step-counter {
    width: 40px;
    height: 40px;
    font-size: 1rem;
  }
  .step-name {
    font-size: 0.8rem;
  }
}

@media (max-width: 576px) {
  .step-counter {
    width: 35px;
    height: 35px;
    font-size: 0.9rem;
  }
  .step-name {
    font-size: 0.75rem;
  }
  .stepper-item::before,
  .stepper-item::after {
    top: 20px;
  }
}
</style>
{% endblock %}